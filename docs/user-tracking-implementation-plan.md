# ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ÑƒÑ‡ĞµÑ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

## ğŸ“‹ ĞĞ±Ğ·Ğ¾Ñ€

Ğ¦ĞµĞ»ÑŒ: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞµĞ´Ğ¸Ğ½ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ ÑƒÑ‡ĞµÑ‚Ğ° Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ Ğ¾Ñ‚ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ (ĞºĞ¾ÑˆĞµĞ»ĞµĞº MetaMask, email, Google OAuth), Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.

**Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ:**

- âœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Email/Google OAuth Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ Ğ² Ğ‘Ğ” Ñ‡ĞµÑ€ĞµĞ· NextAuth
- âŒ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· MetaMask Ğ½Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ Ğ² Ğ‘Ğ”, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ cookie
- âŒ ĞĞµÑ‚ ĞµĞ´Ğ¸Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑÑ‚Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- âŒ ĞĞµÑ‚ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸

---

## ğŸ¯ Ğ¦ĞµĞ»Ğ¸ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

1. **Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ğ±Ğ°Ğ·Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹** â€” Ğ²ÑĞµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ‘Ğ”
2. **Ğ¡Ğ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ²** â€” ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼Ğ¸ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ°Ğ¼Ğ¸ (email + ĞºĞ¾ÑˆĞµĞ»ĞµĞº), ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒ Ğ¸Ñ…
3. **ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°** â€” Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹, Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸, Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
4. **Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸** â€” Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

### Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Email/Google OAuth         â”‚      MetaMask Wallet          â”‚
â”‚  (NextAuth)                 â”‚      (Cookie-based)           â”‚
â”‚                             â”‚                               â”‚
â”‚  âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² Ğ‘Ğ”        â”‚      âŒ ĞĞµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ        â”‚
â”‚  âœ… users, accounts,        â”‚      âŒ Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ cookie          â”‚
â”‚     sessions Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹         â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒÑ‡ĞµÑ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Email/Google    â”‚         â”‚  MetaMask        â”‚          â”‚
â”‚  â”‚  OAuth           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Wallet          â”‚          â”‚
â”‚  â”‚                  â”‚         â”‚                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                            â”‚                     â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                        â–¼                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚   Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° users      â”‚                        â”‚
â”‚              â”‚  (ĞµĞ´Ğ¸Ğ½Ğ°Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ…)   â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                        â”‚                                     â”‚
â”‚                        â–¼                                     â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚        â”‚  ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°          â”‚                 â”‚
â”‚        â”‚  (Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ + Ğ‘Ğ”)           â”‚                 â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `users` (ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚)

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,
  name TEXT,
  email TEXT UNIQUE,
  "emailVerified" TIMESTAMP,
  image TEXT,

  -- Custom fields
  auth_type TEXT DEFAULT 'email' CHECK (auth_type IN ('email', 'wallet')),
  wallet_address TEXT UNIQUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² ÑÑ…ĞµĞ¼Ğµ

**ĞĞ¿Ñ†Ğ¸Ñ 1: Ğ Ğ°ÑÑˆĞ¸Ñ€Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ** (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)

- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğµ `last_login_at` Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğµ `login_count` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ÑÑ‡ĞµÑ‚Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ¾Ğ²
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğµ `registration_method` Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ (`email`, `google`, `wallet`)

**ĞĞ¿Ñ†Ğ¸Ñ 2: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½ÑƒÑ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `user_activity`**

- Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ¾Ğ²
- Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- Ğ‘Ğ¾Ğ»ĞµĞµ Ğ³Ğ¸Ğ±ĞºĞ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

---

## ğŸ”§ ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ­Ñ‚Ğ°Ğ¿ 1: ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (1-2 Ñ‡Ğ°ÑĞ°)

#### 1.1. ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ users

**Ğ¤Ğ°Ğ¹Ğ»:** `lib/database/migrations/add-user-tracking-fields.sql`

```sql
-- Add fields for user tracking
ALTER TABLE users
  ADD COLUMN IF NOT EXISTS last_login_at TIMESTAMP WITH TIME ZONE,
  ADD COLUMN IF NOT EXISTS login_count INTEGER DEFAULT 0,
  ADD COLUMN IF NOT EXISTS registration_method TEXT CHECK (registration_method IN ('email', 'google', 'wallet'));

-- Update existing records
UPDATE users
SET registration_method = 'email'
WHERE registration_method IS NULL AND email IS NOT NULL;

-- Add index for analytics queries
CREATE INDEX IF NOT EXISTS idx_users_registration_method ON users(registration_method);
CREATE INDEX IF NOT EXISTS idx_users_last_login ON users(last_login_at);
```

#### 1.2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ user_activity (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸)

**Ğ¤Ğ°Ğ¹Ğ»:** `lib/database/migrations/create-user-activity-table.sql`

```sql
CREATE TABLE IF NOT EXISTS user_activity (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  activity_type TEXT NOT NULL CHECK (activity_type IN ('login', 'logout', 'wallet_connect', 'transaction', 'request_created')),
  metadata JSONB,
  ip_address TEXT,
  user_agent TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX IF NOT EXISTS idx_user_activity_user_id ON user_activity(user_id);
CREATE INDEX IF NOT EXISTS idx_user_activity_type ON user_activity(activity_type);
CREATE INDEX IF NOT EXISTS idx_user_activity_created_at ON user_activity(created_at);
```

### Ğ­Ñ‚Ğ°Ğ¿ 2: API Ğ´Ğ»Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ñ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ¾Ğ¼ (2-3 Ñ‡Ğ°ÑĞ°)

#### 2.1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ² queries.ts

**Ğ¤Ğ°Ğ¹Ğ»:** `lib/database/user-queries.ts` (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»)

```typescript
import { db } from "./drizzle";
import { users } from "./auth-schema";
import { eq, or } from "drizzle-orm";

export interface CreateWalletUserData {
  walletAddress: `0x${string}`;
  email?: string;
  name?: string;
}

export interface UpdateUserLoginData {
  userId: string;
  ipAddress?: string;
  userAgent?: string;
}

/**
 * Create or update user with wallet address
 * If user exists by email, link wallet to existing account
 * If user exists by wallet, update last login
 * Otherwise, create new user
 */
export async function upsertWalletUser(
  data: CreateWalletUserData,
): Promise<{ id: string; isNewUser: boolean }> {
  const { walletAddress, email, name } = data;

  // Check if user exists by wallet address
  const existingWalletUser = await db
    .select()
    .from(users)
    .where(eq(users.walletAddress, walletAddress))
    .limit(1);

  if (existingWalletUser.length > 0) {
    // Update last login
    await db
      .update(users)
      .set({
        lastLoginAt: new Date(),
        loginCount: existingWalletUser[0].loginCount + 1,
        updatedAt: new Date(),
      })
      .where(eq(users.id, existingWalletUser[0].id));

    return { id: existingWalletUser[0].id, isNewUser: false };
  }

  // Check if user exists by email (to link wallet to existing account)
  if (email) {
    const existingEmailUser = await db.select().from(users).where(eq(users.email, email)).limit(1);

    if (existingEmailUser.length > 0) {
      // Link wallet to existing email account
      await db
        .update(users)
        .set({
          walletAddress,
          authType: "wallet", // Update auth type
          lastLoginAt: new Date(),
          loginCount: existingEmailUser[0].loginCount + 1,
          updatedAt: new Date(),
        })
        .where(eq(users.id, existingEmailUser[0].id));

      return { id: existingEmailUser[0].id, isNewUser: false };
    }
  }

  // Create new user
  const [newUser] = await db
    .insert(users)
    .values({
      walletAddress,
      email: email || null,
      name: name || null,
      authType: "wallet",
      registrationMethod: "wallet",
      lastLoginAt: new Date(),
      loginCount: 1,
    })
    .returning({ id: users.id });

  return { id: newUser.id, isNewUser: true };
}

/**
 * Log user activity
 */
export async function logUserActivity(
  userId: string,
  activityType: string,
  metadata?: Record<string, unknown>,
  ipAddress?: string,
  userAgent?: string,
) {
  // If user_activity table exists
  const { pool } = await import("./drizzle");
  await pool.query(
    `INSERT INTO user_activity (user_id, activity_type, metadata, ip_address, user_agent)
     VALUES ($1, $2, $3, $4, $5)`,
    [userId, activityType, JSON.stringify(metadata || {}), ipAddress || null, userAgent || null],
  );
}

/**
 * Get user statistics
 */
export async function getUserStatistics() {
  const { pool } = await import("./drizzle");
  const result = await pool.query(`
    SELECT 
      COUNT(*) as total_users,
      COUNT(DISTINCT CASE WHEN auth_type = 'wallet' THEN id END) as wallet_users,
      COUNT(DISTINCT CASE WHEN auth_type = 'email' THEN id END) as email_users,
      COUNT(DISTINCT CASE WHEN registration_method = 'email' THEN id END) as email_registrations,
      COUNT(DISTINCT CASE WHEN registration_method = 'google' THEN id END) as google_registrations,
      COUNT(DISTINCT CASE WHEN registration_method = 'wallet' THEN id END) as wallet_registrations,
      COUNT(DISTINCT CASE WHEN last_login_at >= NOW() - INTERVAL '24 hours' THEN id END) as active_24h,
      COUNT(DISTINCT CASE WHEN last_login_at >= NOW() - INTERVAL '7 days' THEN id END) as active_7d,
      COUNT(DISTINCT CASE WHEN last_login_at >= NOW() - INTERVAL '30 days' THEN id END) as active_30d
    FROM users
  `);

  return result.rows[0];
}
```

#### 2.2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ API endpoint

**Ğ¤Ğ°Ğ¹Ğ»:** `app/api/user/register-wallet/route.ts`

```typescript
import { NextRequest, NextResponse } from "next/server";
import { upsertWalletUser, logUserActivity } from "@/lib/database/user-queries";

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { walletAddress, email, name } = body;

    // Validate wallet address
    if (!walletAddress || !/^0x[a-fA-F0-9]{40}$/.test(walletAddress)) {
      return NextResponse.json({ error: "Invalid wallet address" }, { status: 400 });
    }

    // Get IP address and user agent
    const ipAddress =
      request.headers.get("x-forwarded-for") || request.headers.get("x-real-ip") || "unknown";
    const userAgent = request.headers.get("user-agent") || "unknown";

    // Create or update user
    const { id: userId, isNewUser } = await upsertWalletUser({
      walletAddress: walletAddress as `0x${string}`,
      email,
      name,
    });

    // Log activity
    try {
      await logUserActivity(
        userId,
        isNewUser ? "registration" : "login",
        {
          method: "wallet",
          walletAddress,
        },
        ipAddress,
        userAgent,
      );
    } catch (activityError) {
      // Don't fail if activity logging fails
      console.error("Failed to log activity:", activityError);
    }

    return NextResponse.json({
      success: true,
      userId,
      isNewUser,
    });
  } catch (error) {
    console.error("Error registering wallet user:", error);
    return NextResponse.json({ error: "Failed to register user" }, { status: 500 });
  }
}
```

### Ğ­Ñ‚Ğ°Ğ¿ 3: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ MetaMask (1-2 Ñ‡Ğ°ÑĞ°)

#### 3.1. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ use-wallet-connection.ts

**Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²:** `hooks/use-wallet-connection.ts`

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ñ‹Ğ·Ğ¾Ğ² API Ğ¿Ğ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ:

```typescript
// After successful connection
const handleConnect = useCallback(async () => {
  // ... existing connection code ...

  try {
    await connectAsync({
      connector: metaMaskConnector,
      chainId: DEFAULT_CHAIN.id,
    });

    // Register user in database
    if (address) {
      try {
        const response = await fetch("/api/user/register-wallet", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            walletAddress: address,
            // Optionally send email if available
            // email: userEmail,
          }),
        });

        if (!response.ok) {
          console.error("Failed to register wallet user");
        } else {
          const data = await response.json();
          console.log("User registered:", data);
        }
      } catch (registerError) {
        // Don't fail connection if registration fails
        console.error("Error registering user:", registerError);
      }
    }
  } catch (error) {
    // ... existing error handling ...
  }
}, [connectAsync, metaMaskConnector, address]);
```

#### 3.2. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ login page

**Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²:** `app/login/page.tsx`

Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ MetaMask Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ:

```typescript
const handleMetaMaskConnect = async () => {
  try {
    if (isConnected && address) {
      // Register user in database
      await fetch("/api/user/register-wallet", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          walletAddress: address,
        }),
      });

      Cookies.set("metamask_connected", "true", { expires: 7 });
      toast.success(t("login.walletConnected"));
      setTimeout(() => {
        router.push("/");
      }, 1500);
    } else {
      await connect();
    }
  } catch (error) {
    // ... error handling ...
  }
};
```

### Ğ­Ñ‚Ğ°Ğ¿ 4: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ NextAuth Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ (1 Ñ‡Ğ°Ñ)

#### 4.1. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ auth.ts

**Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²:** `lib/auth.ts`

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ NextAuth:

```typescript
events: {
  async signIn({ user, account, isNewUser }) {
    // Update last login
    if (user.id) {
      try {
        const { pool } = await import("@/lib/database/drizzle");
        await pool.query(
          `UPDATE users
           SET last_login_at = CURRENT_TIMESTAMP,
               login_count = login_count + 1
           WHERE id = $1`,
          [user.id],
        );
      } catch (error) {
        console.error("Failed to update user login:", error);
      }
    }

    // Log activity
    try {
      await logUserActivity(
        user.id,
        isNewUser ? "registration" : "login",
        {
          method: account?.provider || "email",
          provider: account?.provider,
        },
      );
    } catch (error) {
      console.error("Failed to log activity:", error);
    }
  },
  // ... other events ...
}
```

### Ğ­Ñ‚Ğ°Ğ¿ 5: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (2-3 Ñ‡Ğ°ÑĞ°)

#### 5.1. API endpoint Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸

**Ğ¤Ğ°Ğ¹Ğ»:** `app/api/user/statistics/route.ts`

```typescript
import { NextResponse } from "next/server";
import { getUserStatistics } from "@/lib/database/user-queries";
import { auth } from "@/lib/auth";

export async function GET() {
  try {
    const session = await auth();

    // Check if user is admin (add your admin check logic)
    // For now, allow anyone authenticated to view stats
    if (!session?.user) {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const stats = await getUserStatistics();

    return NextResponse.json(stats);
  } catch (error) {
    console.error("Error fetching user statistics:", error);
    return NextResponse.json({ error: "Failed to fetch statistics" }, { status: 500 });
  }
}
```

#### 5.2. ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

**Ğ¤Ğ°Ğ¹Ğ»:** `components/admin/user-statistics.tsx`

```typescript
"use client";

import { useEffect, useState } from "react";
import { Card } from "@/components/ui/card";

interface UserStats {
  total_users: number;
  wallet_users: number;
  email_users: number;
  email_registrations: number;
  google_registrations: number;
  wallet_registrations: number;
  active_24h: number;
  active_7d: number;
  active_30d: number;
}

export function UserStatistics() {
  const [stats, setStats] = useState<UserStats | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch("/api/user/statistics")
      .then((res) => res.json())
      .then((data) => {
        setStats(data);
        setLoading(false);
      })
      .catch((error) => {
        console.error("Error fetching statistics:", error);
        setLoading(false);
      });
  }, []);

  if (loading) return <div>Loading...</div>;
  if (!stats) return <div>No statistics available</div>;

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      <Card>
        <h3>Total Users</h3>
        <p className="text-2xl font-bold">{stats.total_users}</p>
      </Card>
      <Card>
        <h3>Registration Methods</h3>
        <ul>
          <li>Email: {stats.email_registrations}</li>
          <li>Google: {stats.google_registrations}</li>
          <li>Wallet: {stats.wallet_registrations}</li>
        </ul>
      </Card>
      <Card>
        <h3>Active Users</h3>
        <ul>
          <li>Last 24h: {stats.active_24h}</li>
          <li>Last 7 days: {stats.active_7d}</li>
          <li>Last 30 days: {stats.active_30d}</li>
        </ul>
      </Card>
    </div>
  );
}
```

---

## ğŸ”Œ Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸

### Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

#### 1. **PostHog** (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ) â­

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**

- âœ… Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½ Ğ´Ğ¾ 1M ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹/Ğ¼ĞµÑÑÑ†
- âœ… Product analytics + feature flags
- âœ… Self-hosted Ğ¾Ğ¿Ñ†Ğ¸Ñ
- âœ… GDPR compliant
- âœ… ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ

**Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°:**

```bash
npm install posthog-js
```

**Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ:**

```typescript
// lib/analytics/posthog.ts
import posthog from "posthog-js";

if (typeof window !== "undefined") {
  posthog.init(process.env.NEXT_PUBLIC_POSTHOG_KEY!, {
    api_host: process.env.NEXT_PUBLIC_POSTHOG_HOST || "https://app.posthog.com",
  });
}

export { posthog };
```

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

```typescript
// Track user registration
posthog.identify(userId, {
  email: user.email,
  authType: user.authType,
  registrationMethod: "wallet",
});

posthog.capture("user_registered", {
  method: "wallet",
  walletAddress: address,
});
```

#### 2. **Mixpanel**

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**

- âœ… ĞœĞ¾Ñ‰Ğ½Ğ°Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°
- âœ… ĞšĞ¾Ğ³Ğ¾Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
- âœ… Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½ Ğ´Ğ¾ 20M ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹/Ğ¼ĞµÑÑÑ†

**ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸:**

- âŒ ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¸Ğ·Ğ±Ñ‹Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡

#### 3. **Segment**

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**

- âœ… Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸
- âœ… Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ¾Ğ¼ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²

**ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸:**

- âŒ Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ€Ñ‚Ğ°Ğ¿Ğ¾Ğ²

#### 4. **ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ±Ğ°Ğ·Ğµ Ğ‘Ğ”** (Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°)

ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `user_activity` Ğ² Ğ‘Ğ” Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.

---

## ğŸ“ Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ­Ñ‚Ğ°Ğ¿ 1: Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `users`
- [ ] (ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `user_activity`
- [ ] ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğº Ğ‘Ğ”
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹

### Ğ­Ñ‚Ğ°Ğ¿ 2: API Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸

- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `lib/database/user-queries.ts`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `upsertWalletUser`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `logUserActivity`
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `getUserStatistics`
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ API endpoint `/api/user/register-wallet`
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ API endpoint `/api/user/statistics`

### Ğ­Ñ‚Ğ°Ğ¿ 3: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ

- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `hooks/use-wallet-connection.ts`
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `app/login/page.tsx`
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `lib/auth.ts` Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ OAuth

### Ğ­Ñ‚Ğ°Ğ¿ 4: UI (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞ¸ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

### Ğ­Ñ‚Ğ°Ğ¿ 5: Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ

- [ ] Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ (PostHog Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)
- [ ] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ñ€ĞµĞºĞ¸Ğ½Ğ³ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹

### Ğ­Ñ‚Ğ°Ğ¿ 6: Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾ÑˆĞµĞ»ĞµĞº
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ email + ĞºĞ¾ÑˆĞµĞ»ĞµĞº
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸

### Ğ­Ñ‚Ğ°Ğ¿ 7: Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ `docs/architecture.md`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ ÑƒÑ‡ĞµÑ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ¿Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸

---

## ğŸ”’ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ

### ĞœĞµÑ€Ñ‹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸

1. **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:**
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° wallet address
   - Ğ¡Ğ°Ğ½Ğ¸Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ email
   - ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ğ¸Ğ½Ñ‹ Ğ¿Ğ¾Ğ»ĞµĞ¹

2. **Rate limiting:**
   - ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ñ‹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ IP
   - Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ ÑĞ¿Ğ°Ğ¼Ğ°

3. **ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ:**
   - ĞĞµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğµ ĞºĞ»ÑÑ‡Ğ¸
   - ĞœĞ°ÑĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ wallet addresses Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…
   - GDPR compliance (ĞµÑĞ»Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ)

4. **ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
   - Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼
   - ĞĞ´Ğ¼Ğ¸Ğ½ÑĞºĞ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²

---

## ğŸ“Š ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

```typescript
// Server Component
import { getUserStatistics } from "@/lib/database/user-queries";

export default async function AdminPage() {
  const stats = await getUserStatistics();

  return (
    <div>
      <h1>User Statistics</h1>
      <p>Total Users: {stats.total_users}</p>
      <p>Wallet Users: {stats.wallet_users}</p>
      <p>Email Users: {stats.email_users}</p>
    </div>
  );
}
```

### ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ² Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞµ

```typescript
// After successful wallet connection
import { posthog } from "@/lib/analytics/posthog";

posthog.identify(userId, {
  walletAddress: address,
  authType: "wallet",
});

posthog.capture("wallet_connected", {
  walletAddress: address,
  chainId: chainId,
});
```

---

## ğŸš€ ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### Must Have (MVP)

1. âœ… ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ” Ğ´Ğ»Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `users`
2. âœ… API endpoint Ğ´Ğ»Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ñ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ¾Ğ¼
3. âœ… Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ MetaMask
4. âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ NextAuth Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸

### Should Have

5. âšª Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `user_activity` Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
6. âšª API endpoint Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
7. âšª ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸

### Nice to Have

8. âšª Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ (PostHog)
9. âšª ĞĞ´Ğ¼Ğ¸Ğ½ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
10. âšª Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

---

## â±ï¸ ĞÑ†ĞµĞ½ĞºĞ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸

| Ğ­Ñ‚Ğ°Ğ¿                | Ğ’Ñ€ĞµĞ¼Ñ    | ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚    |
| ------------------- | -------- | ------------ |
| ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ‘Ğ”       | 1-2 Ñ‡Ğ°ÑĞ° | Must Have    |
| API Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸       | 2-3 Ñ‡Ğ°ÑĞ° | Must Have    |
| Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ          | 1-2 Ñ‡Ğ°ÑĞ° | Must Have    |
| ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ NextAuth | 1 Ñ‡Ğ°Ñ    | Must Have    |
| Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° API      | 1-2 Ñ‡Ğ°ÑĞ° | Should Have  |
| UI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹       | 2-3 Ñ‡Ğ°ÑĞ° | Should Have  |
| Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ      | 2-3 Ñ‡Ğ°ÑĞ° | Nice to Have |
| Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ        | 2-3 Ñ‡Ğ°ÑĞ° | Must Have    |
| Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ        | 1 Ñ‡Ğ°Ñ    | Must Have    |

**ĞĞ±Ñ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ (MVP):** 8-11 Ñ‡Ğ°ÑĞ¾Ğ²  
**ĞĞ±Ñ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ (Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ):** 13-19 Ñ‡Ğ°ÑĞ¾Ğ²

---

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

- [PostHog Documentation](https://posthog.com/docs)
- [NextAuth.js Events](https://next-auth.js.org/configuration/events)
- [Drizzle ORM Documentation](https://orm.drizzle.team/docs/overview)

---

**Ğ’ĞµÑ€ÑĞ¸Ñ Ğ¿Ğ»Ğ°Ğ½Ğ°:** 1.0  
**Ğ”Ğ°Ñ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ:** 2025-01-XX  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ“Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

